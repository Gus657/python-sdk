language: python
addons:
  sonarcloud:
    organization: "configcat"
    token:
      secure: "hnElflL/OvlPpC2Y6qYTF9rUJJbCQjCcmMVzRpScAZU7XYuWmGfPQIXAWV6T2+oB2iqJDuZHVMCOkx0uelIwKqs999KzTiD7js+sj0nEi1jnABGL171ooaI+KRjiclbW8DrTSnQ5hno0HKG/0xZWct1wYIVE+6yqD/iyTK9ktM8GxzYtC+ngL3xBQGc9/0sJxosHReaPEefRnFHyjow2vonRCtf5TcptTu2Jbt4q2KEIdrnM9EDydV736j2xBEkyHLdzEWZS8YAuHrKsiUwMQ/dxF1gTGWMKXiQlKgOLNiDnZ5MoZoEbP6YYk6cJrVxhEvpomzC189AuKMfUkniCVAxgQBRluawDBtsyQ9jjuNz3AoCEwSahnsrWOqTW6bny/OtcP4DP5/r1ZsFtZMbwHwwoktQZki6UJruR+Jl3oeKQLpnu3UvyZ5lK6X84bGCFqxO3p+GKXNLi/MLMeRU9NZWK03c/Xsn910TsBUyXxEv3ZS7J9aCSZFKXJFnfr+vZdnyTBVB/eZVQuvhLRND7c74ggaBctnIU0CAgaLhtO6wHvKxloI90QL4ae/glPC02AMRvpHjOdhJ4hsTCfedrfdK8wLRuinXMMXdSgorRDIFAi+Fuck6wMhcqgpBJmt25tNRQokDz4lI1kouaAgg5GLX97f51ZHl/88OGvp2IWEg="
sudo: true
jobs:
  - { python: "2.6", dist: "trusty" }
  - { python: "2.7", dist: "trusty" }
  - { python: "3.3", dist: "trusty" }
  - { python: "3.4", dist: "trusty" }
  - { python: "3.5", dist: "trusty" }
  - { python: "3.6", dist: "trusty" }
  - { python: "3.7", dist: "xenial" }
  - { python: "3.8", dist: "xenial" }
# command to install dependencies
install:
  - "virtualenv venv --no-site-packages"
  - "source venv/bin/activate"
  - pip install --upgrade pip setuptools
  - pip install mock --upgrade
  - pip install pytest --upgrade
  - pip install pytest-cov --upgrade
  - pip install codecov
  - pip install --force-reinstall twine==1.12.1
  - pip install -r requirements.txt
# command to run tests
script:
  - py.test --cov=configcatclient configcatclienttests
  - sonar-scanner
after_success:
  - codecov
deploy:
  provider: pypi
  twine_version: 1.12.1
  user: "$PYPI_USERNAME"
  password: "$PYPI_PASSWORD"
  skip_existing: true
  skip_cleanup: true
  edge: true
  on:
    tags: true
    branch: master
    python: 2.7
notifications:
  email:
    recipients:
      - developer@configcat.com
    on_success: never
    on_failure: always

